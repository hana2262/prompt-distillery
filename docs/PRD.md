# 产品需求文档 (PRD)

## Prompt Distillery V2 - AI 驱动的 Prompt 整理工具

**版本**: 1.0.0
**最后更新**: 2026-02-25
**项目目标**: 一款带 AI 整理功能的 Prompt 桌面工具，帮助用户高效管理和优化 AI 提示词

---

## 1. 用户路径 (User Journey)

### 核心流程图

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ 复制 Prompt │ -> │ AI 分析     │ -> │ 模板生成    │ -> │ 一键复制    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
      │                  │                  │                  │
      v                  v                  v                  v
  剪贴板监听        查重/合并逻辑      模板填空         返回剪贴板
```

### 详细步骤

#### 步骤 1: 输入 Prompt
- 用户复制任意文本到剪贴板
- 应用通过剪贴板监听自动捕获
- 或用户手动粘贴/输入到输入框

#### 步骤 2: AI 智能分析
- 系统对 Prompt 进行语义分析
- 查重检测：与已有模板匹配度分析
- 合并建议：识别可复用的组件
- 分类标签：自动打标（创作/编程/问答等）

#### 步骤 3: 模板生成
- 根据分析结果生成结构化模板
- 用户可调整模板参数
- 模板占位符预览

#### 步骤 4: 一键复制
- 点击复制按钮，生成内容写入剪贴板
- 可选择原版或优化版

---

## 2. 功能列表 (Features)

### 2.1 剪贴板监听

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 自动监听 | 后台监听剪贴板变化，自动捕获文本 | P0 |
| 手动输入 | 用户主动粘贴或输入 Prompt | P0 |
| 监听开关 | 可开启/关闭自动监听 | P1 |
| 过滤规则 | 忽略非文本内容，可配置关键词过滤 | P2 |

### 2.2 AI 智能分析

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 查重检测 | 与已有模板计算相似度 | P0 |
| 合并逻辑 | 识别重复模式，提取公共部分 | P0 |
| 自动标签 | 根据内容自动添加分类标签 | P1 |
| 优化建议 | 提供 Prompt 优化方向 | P1 |
| 语义分析 | 理解 Prompt 意图和结构 | P2 |

### 2.3 模板管理

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 模板创建 | 从分析结果创建模板 | P0 |
| 模板编辑 | 修改模板内容占位符 | P0 |
| 模板收藏 | 收藏常用模板 | P1 |
| 模板分类 | 按标签/场景分类管理 | P1 |
| 一键复制 | 点击复制生成结果 | P0 |

### 2.4 窗口模式切换

| 模式 | 说明 | 尺寸 | 优先级 |
|------|------|------|--------|
| Mini 模式 | 悬浮球/小窗口，仅核心功能 | 300x200 | P0 |
| Standard 模式 | 标准窗口，完整功能 | 800x600 | P0 |
| Editor 模式 | 编辑器模式，宽阔编辑空间 | 1200x800 | P1 |

#### 模式切换方式
- 托盘图标菜单切换
- 快捷键切换 (Ctrl+M 循环切换)
- 窗口边缘拖拽调整

---

## 3. 数据结构 (Data Schema)

### PromptTemplate 对象

```json
{
  "id": "uuid-v4-string",
  "name": "模板名称",
  "content": "模板内容，包含占位符 {{placeholder}}",
  "category": ["创作", "编程"],
  "tags": ["写作", "论文", "辅助"],
  "variables": [
    {
      "key": "placeholder",
      "label": "变量标签",
      "type": "string",
      "default": "",
      "required": true
    }
  ],
  "aiAnalysis": {
    "similarity": 0.85,
    "mergedFrom": ["template-id-1", "template-id-2"],
    "suggestions": ["建议1", "建议2"]
  },
  "usage": {
    "count": 42,
    "lastUsed": "2026-02-25T10:30:00Z"
  },
  "createdAt": "2026-01-15T08:00:00Z",
  "updatedAt": "2026-02-25T10:30:00Z"
}
```

### PromptRecord 对象 (历史记录)

```json
{
  "id": "uuid-v4-string",
  "originalContent": "原始 Prompt 内容",
  "analyzedContent": "AI 分析后的内容",
  "templateId": "关联的模板 ID",
  "status": "new | matched | merged | copied",
  "timestamp": "2026-02-25T10:30:00Z"
}
```

### AppSettings 对象 (应用配置)

```json
{
  "clipboardMonitor": {
    "enabled": true,
    "autoCapture": true,
    "ignoreKeywords": ["password", "token"]
  },
  "window": {
    "mode": "standard",
    "lastSize": { "width": 800, "height": 600 },
    "position": { "x": 100, "y": 100 }
  },
  "theme": "light",
  "language": "zh-CN"
}
```

---

## 4. 技术栈约束

### 核心技术

| 技术 | 版本 | 用途 |
|------|------|------|
| Electron | ^40.6.x | 桌面应用框架 |
| Vue 3 | ^3.4.x (CDN) | 前端框架 |
| Tailwind CSS | ^3.4.x | 样式框架 |
| localStorage | - | 本地数据存储 |

### 技术约束

- **前端渲染**: Vue 3 通过 CDN 引入 (不使用 Vue CLI/Vite)
- **样式方案**: 仅使用 Tailwind CSS，禁止硬编码样式
- **数据存储**: localStorage，不使用数据库
- **IPC 通信**: 所有主进程通信必须通过 preload.js 暴露
- **窗口管理**: 主进程管理 BrowserWindow

### 模块划分

```
src/
├── main/           # Electron 主进程
│   ├── index.js    # 入口
│   ├── ipc.js      # IPC 处理器
│   ├── menu.js     # 菜单配置
│   └── tray.js     # 托盘
└── renderer/       # 渲染进程
    ├── index.html  # 入口 HTML
    ├── app.js      # Vue 应用
    ├── components/ # 组件
    └── styles/     # Tailwind 配置
```

---

## 5. 用户体验保障 (UX Safeguards)

### 5.1 撤销与草稿机制

| 场景 | 解决方案 |
|------|----------|
| 填写模板变量时被切换 | **自动草稿保存**: 每 5 秒自动保存当前填写内容 |
| 意外关闭窗口 | **草稿恢复**: 重新打开时提示恢复未完成的内容 |
| 误操作撤销 | **撤销栈**: 支持 Ctrl+Z 撤销最近 20 步操作 |

- 草稿数据存储在 localStorage，键名: `draft_{templateId}`
- 超过 24 小时的草稿自动清理

### 5.2 复制后反馈机制

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| 复制后行为 | 复制完成后窗口动作 | 可选: 保持不变 / 最小化 / 隐藏 |
| 通知提示 | 复制成功时显示 Toast | 开启 |
| 自动隐藏延迟 | 隐藏前的等待时间 (ms) | 500 |

- **推荐默认行为**: 复制后自动隐藏窗口，用户可直接切换到目标软件粘贴
- 用户可在设置中修改此行为

### 5.3 剪贴板监听隐私保护

| 功能 | 说明 |
|------|------|
| 静默模式 | 可完全关闭剪贴板监听，无任何弹窗 |
| 白名单机制 | 仅对指定应用复制的内容触发 (可选) |
| 敏感词过滤 | 默认忽略包含 "password", "token", "密钥" 等关键词的内容 |
| 监听指示器 | 状态栏显示当前监听状态 (绿点/红点) |

- **默认策略**: 关闭自动监听，用户手动开启
- 首次开启时显示隐私说明

### 5.4 AI 分析可追溯性

| 功能 | 说明 |
|------|------|
| Diff 对比视图 | 原版与优化版并排展示，高亮差异 |
| 版本历史 | 保存最近 5 次修改记录 |
| 仅保存原版 | 用户可选择不保存优化版本 |
| 一键还原 | 撤销 AI 修改，恢复原始 Prompt |

### 5.5 高频模板快速访问

| 功能 | 说明 | 优先级 |
|------|------|--------|
| 最近使用 | Mini 模式显示最近 5 个使用的模板 | P0 |
| 置顶功能 | 用户可将常用模板固定到顶部 | P1 |
| 搜索 | 快速搜索模板名称/标签 | P0 |
| 使用频率排序 | 自动根据使用次数排序 | P1 |

### 5.6 错误处理与状态提示

| 错误类型 | 用户反馈 |
|----------|----------|
| 网络超时 | Toast 提示"网络超时，请重试"，提供重试按钮 |
| API 错误 | Toast 显示具体错误信息，不阻塞UI |
| 额度用尽 | 弹窗提示，引导用户处理 |
| 数据异常 | 静默降级，显示友好提示 |

- **全局 Toast 系统**: 成功/警告/错误/信息四种类型
- 所有异步操作必须有 loading 状态

### 5.7 窗口模式切换体验

| 问题 | 解决方案 |
|------|----------|
| 位置跳跃 | 记忆每种模式的窗口位置，切换时平滑过渡 |
| 尺寸突变 | 使用动画过渡 (300ms ease-out) |
| 上下文丢失 | 切换模式时自动保存当前状态 |

- **位置记忆**: 每种模式独立记忆 `lastPosition` 和 `lastSize`
- 从 Mini 切换到 Standard 时，窗口从右下角动画展开到居中

### 5.8 多变量填表单疲劳 (Form Fatigue)

| 功能 | 说明 |
|------|------|
| Tab Index 管理 | 按 DOM 顺序定义 Tab 焦点顺序，确保 Tab 键从第一个变量依次跳到最后一个，最后才是操作按钮 |
| 跳过禁用字段 | Tab 键自动跳过 `disabled` 状态的输入框 |
| 记忆历史值 | 同一个模板的同一个变量，自动填充上次填写的内容（显示为 placeholder） |
| 一键清空 | 每个输入框右侧提供清空按钮，快速重新填写 |
| Enter 提交 | 最后一个变量按 Enter 键直接提交表单 |

- **Tab 顺序验证**: 焦点顺序必须符合视觉逻辑（从左到右，从上到下）
- **历史值存储**: localStorage 键名 `history_{templateId}_{variableKey}`，最多保存 10 条

### 5.9 冲突解决机制 (Merge Conflict)

| 场景 | 处理策略 |
|------|----------|
| 编辑中收到新剪贴板 | **编辑状态优先级**: 当任一输入框获得焦点时，暂停所有自动弹窗和后台监听提示 |
| 后台任务打断编辑 | 除非用户主动保存或取消编辑，否则不弹出任何提示 |
| 草稿覆盖保护 | 检测到未保存草稿时，弹窗询问"覆盖草稿"或"取消" |
| 退出编辑确认 | 关闭正在编辑的模板时，确认是否保存 |

- **编辑状态检测**: 通过 `document.activeElement` 判断是否有输入框获得焦点
- **静默队列**: 剪贴板新内容在编辑状态下存入待处理队列，用户保存后提示

### 5.10 长文本显示处理 (Long Text Layout)

| 场景 | 解决方案 |
|------|----------|
| 模板列表预览 | 强制截断为前 2 行，末尾显示 `...`，悬停显示完整内容tooltip |
| Mini 模式输入框 | 设置 `max-height: 150px`，超出显示垂直滚动条 |
| 底部按钮固定 | 复制/提交按钮使用 `position: fixed`，始终可见，不被挤出屏幕 |
| 大文本性能优化 | 超过 5000 字符时，延迟渲染或分页加载 |

- **滚动条样式**: 使用自定义滚动条 (Tailwind `scrollbar-thin`)，避免原生滚动条突兀
- **复制按钮位置**: 固定在窗口底部 16px 处，确保任何文本长度下都可用

### 5.11 导航层级与回退逻辑 (Navigation Stack)

| 功能 | 说明 |
|------|------|
| 统一导航栏 | 所有二级页面（设置、历史记录、模板详情）顶部必须有 Back (<) 按钮 |
| 导航层级 | 页面层级: 主界面 -> 二级页面 -> 三级页面（Modal） |
| ESC 键支持 | 按 Esc 键默认行为: "返回上一级"；在主界面按 Esc 则 "最小化/隐藏" |
| 关闭按钮 | 每个弹窗/抽屉右上角必须有明确的关闭 (X) 按钮 |
| 页面标题 | 每个二级页面顶部显示当前页面名称 |

- **回退动画**: 使用右滑动画 (slide-right)，时长 200ms
- **最小化行为**: 在 Mini 模式下按 Esc 隐藏窗口；在 Standard/Editor 模式下最小化到托盘

### 5.12 个性化主题 (Personalization)

| 功能 | 说明 | 默认值 |
|------|------|--------|
| 背景图片 | 允许上传本地图片或输入图片 URL | 无 (纯色背景) |
| 毛玻璃效果 | 背景图上叠加半透明遮罩 | 开启 (`bg-black/50 backdrop-blur-md`) |
| 主题色 | 5 种预设色块一键切换 | 默认: 极客绿 |

**预设主题色**:
| 主题名 | 主色 | 用途 |
|--------|------|------|
| 极客绿 (Geek) | `#10B981` | 按钮、高亮、选中态 |
| 赛博紫 (Cyber) | `#8B5CF6` | 按钮、高亮、选中态 |
| 深海蓝 (Ocean) | `#3B82F6` | 按钮、高亮、选中态 |
| 落日橙 (Sunset) | `#F59E0B` | 按钮、高亮、选中态 |
| 玫瑰粉 (Rose) | `#F43F5E` | 按钮、高亮、选中态 |

- **主题色应用范围**: 按钮背景、输入框聚焦边框、选中项背景、Toast 提示色
- **持久化**: 主题设置存储在 localStorage，键名 `appTheme`

### 5.13 设置页面的非模态化 (Non-Modal Settings)

| 窗口模式 | 设置页面形态 |
|----------|--------------|
| Mini 模式 | 抽屉式 (Drawer)：从右侧滑出，覆盖主界面 |
| Standard 模式 | 独立页面：切换到设置视图 |
| Editor 模式 | 侧边栏：固定在右侧 300px 宽度 |

**抽屉式设置 (Mini 模式)**:
- 宽度: 占窗口宽度的 80%
- 动画: 左滑进入 (slide-left)，时长 200ms
- 关闭方式: 点击 X、点击遮罩层、或按 ESC

- **视觉一致性**: 抽屉背景与主界面使用相同的主题和样式
- **不覆盖主界面**: 抽屉打开时，主界面内容仍在底层可见 (半透明遮罩)

---

## 6. 非功能性需求

### 6.1 性能要求
- 冷启动时间 < 3 秒
- 剪贴板监听响应 < 500ms
- 模板复制操作 < 200ms

### 6.2 兼容性
- Windows 10/11 (主要目标)
- macOS (可选)

### 6.3 安全要求
- 不上传用户数据到服务器
- 所有处理在本地完成
- 敏感信息过滤

### 6.4 交付物要求

| 交付物 | 说明 | 格式 |
|--------|------|------|
| **Windows 安装包** | 用户双击即可安装，带有卸载程序 | `.exe` (NSIS Installer) |
| **Mac 应用包** | 拖拽即可安装 (可选) | `.dmg` |
| **无需环境** | 最终产物必须完全独立，用户无需安装 Node.js 即可运行 | - |

**技术实现**:
- 打包工具: `electron-forge`
- 构建命令: `npm run make`
- 产物位置: `out/` 目录

---

## 7. 里程碑 (Milestones)

| 阶段 | 目标 | 交付物 |
|------|------|--------|
| M1 | 基础框架 | 可运行的 Electron 应用，三种窗口模式 |
| M2 | 剪贴板功能 | 自动/手动捕获，监听开关 |
| M3 | 模板管理 | CRUD 操作，localStorage 持久化 |
| M4 | AI 分析 | 查重、合并逻辑 (本地实现) |
| M5 | 完善优化 | 托盘、快捷键、体验优化 |
| M6 | 打包发布 | Windows .exe 安装包，用户可直接运行 |

---

*本文档为产品需求定义，将根据开发进展持续更新。*
